{"version":3,"file":"frontegg-ng-core.js","sources":["../../src/lib/core.service.ts","../../src/lib/frontegg-provider.component.ts","../../src/lib/frontegg-first-component.component.ts","../../src/lib/frontegg-router.component.ts","../../src/lib/core.module.ts","../../src/public-api.ts","../../src/frontegg-ng-core.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class CoreService {\n\n  constructor() { }\n}\n","import {\n  AfterContentInit,\n  AfterViewInit,\n  Component,\n  ElementRef,\n  Input,\n  OnDestroy,\n  OnInit,\n  Renderer2, ViewContainerRef,\n} from '@angular/core';\nimport { createElement, Wrapper, createPortal, render, FirstComp } from 'ng-test';\nimport { NavigationEnd, NavigationStart, Router } from '@angular/router';\n\n\n@Component({\n  selector: 'frontegg-provider',\n  template: `\n    <!--    <frontegg-router></frontegg-router>-->\n    <ng-content></ng-content>`,\n  styles: [],\n})\nexport class FronteggProviderComponent implements AfterViewInit, OnInit, OnDestroy {\n  rcWrapper: any;\n  rcWrapperRef: any;\n  rcProxy: any;\n  rcPortals: any[] = [];\n  ngChildren: any[] = [];\n  routeListeners: any[] = [];\n  // 1) createElement(RcComponent)\n  //   1.1) pass upper props to RcComponent\n  //   1.2) create smart children component with unique id to inject ng-content after mount\n  // 2) create React Portal to be rendered inside this.elementRef\n  // 3) search for parent Rc Component to inject this ReactPortal to it's children\n  // 4) after React.Portal did mount, inject ng-container to it's smart children component\n\n  constructor(private elem: ElementRef, private router: Router) {\n    this.elem.nativeElement.ngClass = this;\n  }\n\n  ngAfterViewInit(): void {\n    this.rcProxy = document.createElement('div');\n    document.body.appendChild(this.rcProxy);\n    this.ngChildren = [...this.elem.nativeElement.childNodes];\n    const ngComponents = createElement('div', {\n      ref: ref => this.ngChildren.forEach(node => ref?.appendChild(node as any)),\n    }, []);\n\n    // @ts-ignore\n    window.ngH = this.router;\n    // @ts-ignore\n    this.router.location._platformLocation._history.listen = (e) => {\n      this.routeListeners.push(e);\n      return () => {\n        this.routeListeners = this.routeListeners.filter(l => l !== e);\n      };\n    };\n    // @ts-ignore\n    this.router.location._platformLocation._history.createHref = (e) => {\n      return e.pathname;\n    };\n    // @ts-ignore\n    this.router.location._platformLocation._history.push = (path, data) => {\n      // @ts-ignore\n      this.router.navigate([path], { state: data, replaceUrl: false });\n    };\n    // @ts-ignore\n    this.router.location._platformLocation._history.replace = (path, data) => {\n      this.router.navigate([path], { state: data, replaceUrl: true });\n    };\n    // @ts-ignore\n    this.router.location._platformLocation._history.location = this.router.location._platformLocation.location;\n\n    this.router.events.subscribe((event) => {\n      if (event instanceof NavigationEnd) {\n        // @ts-ignore\n        this.routeListeners.forEach(l => l(this.router.location._platformLocation.location));\n      }\n    });\n\n    this.rcWrapper = createPortal(createElement(Wrapper, {\n      ref: ref => this.rcWrapperRef = ref,\n      ngComponents,\n      rcPortals: this.rcPortals,\n      // @ts-ignore\n      _history: this.router.location._platformLocation._history,\n    } as any), this.elem.nativeElement);\n    render(this.rcWrapper, this.rcProxy);\n  }\n\n  ngOnInit(): void {\n\n  }\n\n  public mountChild(child): void {\n    this.rcWrapperRef.mountChild(child);\n  }\n\n  public unmountChild(child): void {\n    this.rcWrapperRef.unmountChild(child);\n  }\n\n  ngOnDestroy(): void {\n    // this.nodeRef?.remove();\n  }\n\n}\n","import { AfterViewInit, Component, ElementRef, OnDestroy, OnInit } from '@angular/core';\nimport { createElement, createPortal, FirstComp, render } from 'ng-test';\n\n@Component({\n  selector: 'frontegg-first-component',\n  template: `<ng-content></ng-content>`,\n})\nexport class FronteggFirstComponent implements OnInit, AfterViewInit, OnDestroy {\n  rcParent: any;\n  rcPortal: any;\n\n  constructor(private elem: ElementRef) {\n    console.log('FronteggFirstComponent.constructor');\n    this.elem.nativeElement.ngClass = this;\n  }\n\n  ngAfterViewInit(): void {\n    let parent = this.elem.nativeElement.parentElement;\n    while (parent != null && !parent.ngClass) {\n      parent = parent.parentElement;\n    }\n    this.rcPortal = createPortal(createElement(FirstComp, { isNg: true } as any, null), this.elem.nativeElement);\n    if (!parent) {\n      const rcProxy = document.createElement('div');\n      document.body.appendChild(rcProxy);\n      render(this.rcPortal, rcProxy);\n    } else {\n      this.rcParent = parent.ngClass;\n      this.rcParent.mountChild(this.rcPortal);\n    }\n  }\n\n  ngOnInit(): void {\n    console.log('FronteggFirstComponent.ngOnInit');\n  }\n\n\n  ngOnDestroy(): void {\n    console.log('FronteggFirstComponent.ngOnDestroy');\n    this.rcParent.unmountChild(this.rcPortal);\n  }\n\n}\n","import {\n  AfterContentInit,\n  AfterViewInit,\n  Component,\n  ElementRef,\n  Input,\n  OnDestroy,\n  OnInit,\n  Renderer2, ViewContainerRef,\n} from '@angular/core';\nimport { createElement, Wrapper, createPortal, render, FirstComp } from 'ng-test';\nimport { NavigationEnd, NavigationStart, Router, RoutesRecognized } from '@angular/router';\nimport { filter, pairwise } from 'rxjs/operators';\n\n\n@Component({\n  selector: 'frontegg-router',\n  template: `\n    <ng-content></ng-content>`,\n  styles: [],\n})\nexport class FronteggRouterComponent {\n  constructor(private elem: ElementRef, router: Router) {\n\n    // @ts-ignore\n    window.ngHistory = router;\n    router.events.subscribe((event) => {\n      console.log(event);\n      if (event instanceof NavigationStart) {\n        console.log(event);\n        if (event.navigationTrigger === 'imperative') {\n          // @ts-ignore\n          (window.rcHistory).replace(event.url, event.restoredState);\n        }\n        // @ts-ignore\n        // console.log(window.ngHistory.location._platformLocation._history);\n        // @ts-ignore\n        // Object.assign(window.rcHistory, window.ngHistory.location._platformLocation._history);\n        // event.url\n        // window.localStorage.setItem('previousUrl', this.router.url);\n      }\n    });\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { FronteggProviderComponent } from './frontegg-provider.component';\nimport { PortalModule } from '@angular/cdk/portal';\nimport { CountdownModule } from 'ngx-countdown';\nimport { FronteggFirstComponent } from './frontegg-first-component.component';\nimport { FronteggRouterComponent } from './frontegg-router.component';\n\n\n@NgModule({\n  declarations: [\n    FronteggProviderComponent,\n    FronteggFirstComponent,\n    FronteggRouterComponent,\n  ],\n  imports: [\n    PortalModule,\n    CountdownModule,\n  ],\n  exports: [\n    FronteggProviderComponent,\n    FronteggFirstComponent,\n  ],\n})\nexport class CoreModule {\n}\n","/*\n * Public API Surface of core\n */\n\nexport * from './lib/core.service';\nexport * from './lib/core.module';\nexport * from './lib/frontegg-provider.component';\nexport * from './lib/frontegg-first-component.component';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":["i0.ɵɵprojection"],"mappings":"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"}